apiVersion: karpenter.k8s.aws/v1beta1
kind: EC2NodeClass
metadata:
  name: simulation-nodeclass
spec:
  # AMI family - AL2023 supports K8s 1.33+
  amiFamily: AL2023
  # Subnet selector - deploy script replaces CLUSTER_NAME_PLACEHOLDER
  subnetSelectorTerms:
    - tags:
        karpenter.sh/discovery: "CLUSTER_NAME_PLACEHOLDER"
  # Security group selector
  securityGroupSelectorTerms:
    - tags:
        karpenter.sh/discovery: "CLUSTER_NAME_PLACEHOLDER"
  # Root volume
  blockDeviceMappings:
    - deviceName: /dev/xvda
      ebs:
        volumeSize: 100Gi
        volumeType: gp3
        encrypted: true
        deleteOnTermination: true
  # IAM role (deploy script replaces CLUSTER_NAME_PLACEHOLDER)
  role: "KarpenterNodeRole-CLUSTER_NAME_PLACEHOLDER"
  # Bootstrap script
  userData: |
    #!/bin/bash
    /etc/eks/bootstrap.sh CLUSTER_NAME_PLACEHOLDER

